<mxfile host="app.diagrams.net" modified="2021-07-30T01:10:35.425Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.164 Safari/537.36" etag="1g92UiAo136BcC_JwC0n" version="14.4.2" type="github">
  <diagram id="PGz8U3BKIXKiMVyUwiMm" name="Page-1">
    <mxGraphModel dx="2066" dy="1161" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="QC1wFcTw7xElOVyUpBSb-2" value="&lt;font style=&quot;font-size: 18px&quot;&gt;对象X的 Mark Word&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="177.5" width="360" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-3" value="&lt;font style=&quot;font-size: 16px&quot;&gt;VM Stack&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="349" y="170" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-4" value="&lt;font style=&quot;font-size: 16px&quot;&gt;X&#39;s HashCode&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="760" y="217.5" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-5" value="&lt;font style=&quot;font-size: 16px&quot;&gt;age&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="970" y="217.5" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-6" value="&lt;span style=&quot;font-size: 16px&quot;&gt;0&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1030" y="217.5" width="30" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-7" value="&lt;span style=&quot;font-size: 16px&quot;&gt;01&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1060" y="217.5" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-90" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeColor=#330000;strokeWidth=2;fontSize=18;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-8" target="QC1wFcTw7xElOVyUpBSb-92">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="920" y="90" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#330000;strokeWidth=2;fontSize=18;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-8" target="QC1wFcTw7xElOVyUpBSb-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-8" value="&lt;font style=&quot;font-size: 16px&quot;&gt;Is 01？&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;strokeWidth=2;strokeColor=#330000;" vertex="1" parent="1">
          <mxGeometry x="875" y="55" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-9" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 进入同步代码块前，如果同步对象X未被锁定(aka 标志位为 01)。&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;dashPattern=1 2;strokeWidth=2;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="607.5" y="55" width="240" height="70" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-11" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="349" y="200" width="131" height="170" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-12" value="&lt;font style=&quot;font-size: 16px&quot;&gt;Lock Record&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;strokeColor=#82b366;strokeWidth=2;dashPattern=1 2;fillColor=#d5e8d4;" vertex="1" parent="1">
          <mxGeometry x="364.5" y="217.5" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-13" value="&lt;span style=&quot;font-size: 14px&quot;&gt;其他栈帧&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="364" y="330" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-14" value="&lt;span style=&quot;font-size: 14px&quot;&gt;其他栈帧&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="364" y="290" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-15" value="&lt;font&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; JVM会在当前线程的栈帧中创建一个锁记录 Lock Record。&lt;br&gt;&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; 然后把&lt;/span&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;对象X的 Mark Word 的全部信息存入 Lock Record.&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;fillColor=#d5e8d4;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;glass=0;sketch=0;shadow=0;dashPattern=1 2;strokeWidth=2;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="80" y="210" width="240" height="110" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-16" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;Y&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="910" y="130" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-21" value="&lt;font style=&quot;font-size: 16px&quot;&gt;Mark Word 备份到 Lock Record 中后，通过CAS操作，将绿色部分的信息替换为指向 Lock Record 的指针。&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;strokeWidth=2;align=center;strokeColor=#666666;dashed=1;fillColor=#f5f5f5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="510" y="270" width="220" height="120" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-22" value="" style="endArrow=classic;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-4" target="QC1wFcTw7xElOVyUpBSb-12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="540" as="sourcePoint" />
            <mxPoint x="500" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-23" value="&lt;font style=&quot;font-size: 16px&quot;&gt;mark word中的信息复制到Lock Record中&lt;/font&gt;" style="text;html=1;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;shadow=0;glass=0;dashed=1;dashPattern=1 2;sketch=0;strokeColor=#82b366;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="520" y="160" width="200" height="67.5" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-24" value="&lt;font style=&quot;font-size: 18px&quot;&gt;对象X的 Mark Word&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="460" width="360" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-25" value="&lt;font style=&quot;font-size: 16px&quot;&gt;指向 Lock Record 的指针&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="760" y="500" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-28" value="&lt;span style=&quot;font-size: 16px&quot;&gt;00&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1060" y="500" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-36" value="&lt;font style=&quot;font-size: 18px&quot;&gt;&lt;b&gt;CAS&lt;/b&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=0;shadow=0;glass=0;sketch=0;strokeColor=#66B2FF;strokeWidth=2;align=center;" vertex="1" parent="1">
          <mxGeometry x="847.5" y="260" width="185" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-37" value="&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;成功&lt;br&gt;&lt;/b&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="880" y="350" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-39" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;失败&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1070" y="320" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-43" value="" style="shape=flexArrow;endArrow=classic;html=1;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=#66B2FF;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-36" target="QC1wFcTw7xElOVyUpBSb-24">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="470" as="sourcePoint" />
            <mxPoint x="950" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-44" value="" style="shape=flexArrow;endArrow=classic;html=1;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeColor=#990000;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-36">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="470" as="sourcePoint" />
            <mxPoint x="1390" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-45" value="&lt;font&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;如果该CAS操作成功了，代表当前线程持有该对象的轻量锁，并且修改标记为00，代表对象处于轻量锁定状态。&lt;/span&gt;&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;strokeWidth=2;align=center;strokeColor=#666666;dashed=1;fillColor=#f5f5f5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="510" y="445" width="220" height="140" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-46" value="&lt;font style=&quot;font-size: 16px&quot;&gt;如果CAS失败，则一定是有其他线程在竞争该对象。&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;strokeWidth=2;align=left;fillColor=#f8cecc;strokeColor=#990000;" vertex="1" parent="1">
          <mxGeometry x="1134" y="310" width="214" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=#990000;strokeWidth=2;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-47" target="QC1wFcTw7xElOVyUpBSb-56">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1440" y="660" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeColor=#990000;strokeWidth=2;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-47">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1610" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-47" value="&lt;b&gt;&lt;font style=&quot;font-size: 18px&quot;&gt;Check&lt;/font&gt;&lt;/b&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=1;shadow=0;glass=0;sketch=0;strokeColor=#990000;strokeWidth=2;align=center;" vertex="1" parent="1">
          <mxGeometry x="1390" y="260" width="90" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-50" value="&lt;font style=&quot;font-size: 18px&quot;&gt;JVM 会先检测对象的 Mark Word 是否为指向当前线程的栈中的 Lock Record 的指针。&lt;br&gt;&lt;br&gt;如果是，那说明当前线程抢到这个锁了，执行同步块然后释放锁就好了；&lt;br&gt;&lt;br&gt;如果否，那说明对象被其他线程抢走了，进入自旋 ,自旋如仍然获取不到，则进入锁膨胀。&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;strokeColor=#b85450;strokeWidth=2;align=left;dashed=1;spacingLeft=5;spacingBottom=5;spacingTop=0;spacingRight=5;fillColor=#f8cecc;" vertex="1" parent="1">
          <mxGeometry x="1200" y="55" width="550" height="190" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-53" value="&lt;b&gt;&lt;font style=&quot;font-size: 18px&quot;&gt;YES&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1380" y="380" width="45" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-55" value="&lt;b&gt;&lt;font style=&quot;font-size: 18px&quot;&gt;NO&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1510" y="240" width="45" height="50" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-56" value="&lt;font style=&quot;font-size: 18px&quot;&gt;执行同步块&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;strokeWidth=2;align=center;strokeColor=#330000;" vertex="1" parent="1">
          <mxGeometry x="760" y="640" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-57" value="自旋 --&amp;gt;锁膨胀" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;dashed=1;sketch=0;strokeColor=#990000;strokeWidth=2;align=center;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="1610" y="270" width="150" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-61" value="" style="shape=flexArrow;endArrow=classic;html=1;strokeWidth=2;fontSize=18;strokeColor=#330000;exitX=0.58;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-25">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="900" y="670" as="sourcePoint" />
            <mxPoint x="934" y="640" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-62" value="加锁成功，进入同步块" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;sketch=0;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="847.5" y="567" width="190" height="34.5" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-63" value="进入同步块" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;sketch=0;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="1266.25" y="630" width="113.75" height="34.5" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-64" value="" style="shape=flexArrow;endArrow=classic;html=1;strokeColor=#330000;strokeWidth=2;fontSize=18;exitX=0.483;exitY=0.988;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-56">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="940" y="840" as="sourcePoint" />
            <mxPoint x="934" y="810" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-65" value="开始释放锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;sketch=0;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="806.25" y="740" width="113.75" height="34.5" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-66" value="&lt;font style=&quot;font-size: 18px&quot;&gt;&lt;b&gt;CAS&lt;/b&gt;&lt;/font&gt;" style="rhombus;whiteSpace=wrap;html=1;rounded=0;shadow=0;glass=0;sketch=0;strokeColor=#66B2FF;strokeWidth=2;align=center;" vertex="1" parent="1">
          <mxGeometry x="840" y="892.5" width="185" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-67" value="&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;成功&lt;br&gt;&lt;/b&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="860" y="980" width="50" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-68" value="" style="shape=flexArrow;endArrow=classic;html=1;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=#66B2FF;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="932" y="972.5" as="sourcePoint" />
            <mxPoint x="932" y="1072.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-69" value="" style="shape=flexArrow;endArrow=classic;html=1;strokeColor=#330000;strokeWidth=2;fontSize=18;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1025" y="932" as="sourcePoint" />
            <mxPoint x="1640" y="932" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-70" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;失败&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1050" y="950" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-71" value="&lt;font style=&quot;font-size: 18px&quot;&gt;对象X的 Mark Word&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="760" y="812.5" width="360" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-72" value="&lt;font style=&quot;font-size: 16px&quot;&gt;指向 Lock Record 的指针&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="760" y="852.5" width="300" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-73" value="&lt;span style=&quot;font-size: 16px&quot;&gt;00&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1060" y="852.5" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-74" value="&lt;font&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;通过CAS操作，如果指针&lt;span&gt;还是指向当前线程的 Lock Record，那么就把之前拷贝的 Mark Word 信息还给对象头。&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;sketch=0;strokeWidth=2;align=left;strokeColor=#666666;dashed=1;fillColor=#f5f5f5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="530" y="920" width="290" height="100" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-75" value="&lt;font style=&quot;font-size: 16px&quot;&gt;VM Stack&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="780" width="130" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-76" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="810" width="131" height="170" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=#330000;strokeWidth=2;fontSize=18;" edge="1" parent="1" source="QC1wFcTw7xElOVyUpBSb-77" target="QC1wFcTw7xElOVyUpBSb-72">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-77" value="&lt;font style=&quot;font-size: 16px&quot;&gt;Lock Record&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;strokeColor=#82b366;strokeWidth=2;dashPattern=1 2;fillColor=#d5e8d4;" vertex="1" parent="1">
          <mxGeometry x="375.5" y="827.5" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-78" value="&lt;span style=&quot;font-size: 14px&quot;&gt;其他栈帧&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="375" y="940" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-79" value="&lt;span style=&quot;font-size: 14px&quot;&gt;其他栈帧&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="375" y="900" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-81" value="&lt;font style=&quot;font-size: 16px&quot;&gt;Lock Record&amp;nbsp;&lt;br&gt;将之前存储的 Mark Word 信息归还对象&lt;/font&gt;" style="text;html=1;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;shadow=0;glass=0;dashed=1;dashPattern=1 2;sketch=0;strokeColor=#82b366;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="530" y="760" width="200" height="67.5" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-83" value="&lt;font style=&quot;font-size: 18px&quot;&gt;对象X的 Mark Word&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="752.5" y="1070" width="360" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-84" value="&lt;font style=&quot;font-size: 16px&quot;&gt;X&#39;s HashCode&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="752.5" y="1110" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-85" value="&lt;font style=&quot;font-size: 16px&quot;&gt;age&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="962.5" y="1110" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-86" value="&lt;span style=&quot;font-size: 16px&quot;&gt;0&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1022.5" y="1110" width="30" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-87" value="&lt;span style=&quot;font-size: 16px&quot;&gt;01&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1052.5" y="1110" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-88" value="释放锁过程中如果CAS操作失败，说明有其他线程尝试过获取锁，这时需要在释放锁的同时，唤醒被挂起的线程。特殊情况，该锁有可能已经膨胀成重量级锁了。" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;dashed=1;sketch=0;strokeColor=#b85450;strokeWidth=2;align=center;fontSize=18;fillColor=#f8cecc;" vertex="1" parent="1">
          <mxGeometry x="1150" y="774.5" width="460" height="142.5" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-89" value="锁释放，并唤醒挂起线程。" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=0;dashed=1;sketch=0;strokeColor=#990000;strokeWidth=2;align=center;fontSize=18;" vertex="1" parent="1">
          <mxGeometry x="1640" y="892.5" width="150" height="90" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-91" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;N&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1012.5" y="55" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QC1wFcTw7xElOVyUpBSb-92" value="&lt;span style=&quot;font-size: 16px&quot;&gt;不在轻量级锁流程讨论范围&lt;/span&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;dashPattern=1 2;strokeWidth=2;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1050" y="55" width="130" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
